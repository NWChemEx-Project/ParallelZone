

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using ParallelZone with mpi4py &mdash; parallelzone  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quick Reference / FAQs" href="quick_reference.html" />
    <link rel="prev" title="Using MPI With Custom Types" href="mpi_and_custom_types.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> parallelzone
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing ParallelZone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abbreviations.html">Abbreviations Used Throughout ParallelZone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">The ParallelZone Worldview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ParallelZone User Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="runtime_view.html">The RuntimeView Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="resource_set.html">The ResourceSet Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="ram.html">The RAM Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpi_and_custom_types.html">Using MPI With Custom Types</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using ParallelZone with mpi4py</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mpi-initialization-and-finalization">MPI Initialization and Finalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#passing-mpi4py-communicator-to-parallelzone">Passing mpi4py Communicator to ParallelZone</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quick_reference.html">Quick Reference / FAQs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">parallelzone</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">ParallelZone User Documentation</a> &raquo;</li>
        
      <li>Using ParallelZone with mpi4py</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user/mpi4py.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="using-parallelzone-with-mpi4py">
<h1>Using ParallelZone with mpi4py<a class="headerlink" href="#using-parallelzone-with-mpi4py" title="Permalink to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>mpi4py is not installed by ParallelZone, so should be installed separately.
See <a class="reference external" href="https://mpi4py.readthedocs.io/en/stable/install.html">mpi4py documentation</a> for more information.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Python support for ParallelZone is currently in beta. APIs are not
considered stable at this time and are subject to change.</p>
</div>
<p>mpi4py is the most popular package that provides Python bindings for the MPI standard. Here, we describe
how you can use mpi4py along with ParallelZone.</p>
<section id="mpi-initialization-and-finalization">
<h2>MPI Initialization and Finalization<a class="headerlink" href="#mpi-initialization-and-finalization" title="Permalink to this heading">¶</a></h2>
<p>The MPI standard requires <cite>MPI_Init</cite> or <cite>MPI_Init_thread</cite> function to be called by each process to
initialize the MPI execution environment. mpi4py performs initialization (if necessary)
automatically when <cite>MPI</cite> module is imported with <cite>from mpi4py import MPI</cite>.
By default thread support is enabled with <cite>MPI_THREAD_MULTIPLE</cite> option, which is
also the required thread support level for ParallelZone. If
MPI is already initialized, i.e. by ParallelZone, mpi4py basically uses the
same MPI environment. Finalization is also handled automatically by mpi4py
when Python processes exit.</p>
<p>Therefore, for a general use case, where <cite>MPI_COMM_WORLD</cite> refers to the same
set of resources for mpi4py and ParallelZone, they are compatible with each
other.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to disable automatic initialization of mpi4py or change the
thread support level manually. See the <a class="reference external" href="https://mpi4py.readthedocs.io/en/stable/mpi4py.html?highlight=initialization#runtime-configuration-options">mpi4py documentation</a>
for more details. However, note that it is not possible to pass a
communicator to mpi4py explicitly.</p>
</div>
</section>
<section id="passing-mpi4py-communicator-to-parallelzone">
<h2>Passing mpi4py Communicator to ParallelZone<a class="headerlink" href="#passing-mpi4py-communicator-to-parallelzone" title="Permalink to this heading">¶</a></h2>
<p>If a user is interested in only sharing a subset of resources with ParallelZone,
then the user needs to initialize ParallelZone by passing the communicator
created by mpi4py. An example, where the user passes <cite>MPI_COMM_SELF</cite> as the
communicator for ParallelZone is given below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">cppyy.ll</span>

<span class="n">pz_comm</span> <span class="o">=</span> <span class="n">cppyy</span><span class="o">.</span><span class="n">ll</span><span class="o">.</span><span class="n">cast</span><span class="p">[</span><span class="s2">&quot;MPI_Comm&quot;</span><span class="p">](</span><span class="n">MPI</span><span class="o">.</span><span class="n">_handleof</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_SELF</span><span class="p">))</span>
<span class="n">pz_world</span> <span class="o">=</span> <span class="n">parallelzone</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">RuntimeView</span><span class="p">(</span><span class="n">pz_comm</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="quick_reference.html" class="btn btn-neutral float-right" title="Quick Reference / FAQs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="mpi_and_custom_types.html" class="btn btn-neutral float-left" title="Using MPI With Custom Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, NWChemEx Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>