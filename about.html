<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The ParallelZone Worldview &mdash; parallelzone  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="#" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ParallelZone User Documentation" href="user/index.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            parallelzone
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing ParallelZone</a></li>
<li class="toctree-l1"><a class="reference internal" href="abbreviations.html">Abbreviations Used Throughout ParallelZone</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The ParallelZone Worldview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mpi-primer">MPI Primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#focusing-on-resources">Focusing on Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resource-affinity">Resource Affinity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-vision">The Vision</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user/index.html">ParallelZone User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer/index.html">Developer Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">parallelzone</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">The ParallelZone Worldview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/about.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="the-parallelzone-worldview">
<h1>The ParallelZone Worldview<a class="headerlink" href="#the-parallelzone-worldview" title="Permalink to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TL;DR. In ParallelZone the <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> instance is your handle to the
runtime environment. <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> is a container of <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code>
objects. <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code> objects describe the resources (<em>i.e.</em>, RAM, CPUs,
GPUs, <em>etc.</em>) that processes have direct/local access to.</p>
</div>
<p>To use ParallelZone it is helpful to understand the abstraction model at a high
level. ParallelZone expands on the <a class="reference internal" href="abbreviations.html#mpi"><span class="std std-ref">MPI</span></a> model. So we start with a brief
review of MPI.</p>
<div class="section" id="mpi-primer">
<h2>MPI Primer<a class="headerlink" href="#mpi-primer" title="Permalink to this heading"></a></h2>
<p><a class="reference internal" href="#fig-mpi-runtime"><span class="std std-numref">Fig. 1</span></a> illustrates a simplified version of how MPI sees a
program. The view is process-centric. When the program starts, MPI defines a
set <code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code> which includes all of program’s processes. Within our
example <code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code> has three processes. MPI assigns these processes an
integer value (ranging from 0 to “the number of processes minus 1”) called the
process’s rank. More complicated MPI setups can have further partition
<code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code> into subsets, but the overall point remains: MPI’s view of
a program is a series of processes somehow grouped together.</p>
<div class="figure align-center" id="id1">
<span id="fig-mpi-runtime"></span><img alt="_images/mpi.png" src="_images/mpi.png" />
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Illustration of MPI’s runtime abstraction model.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</div>
<p>In a typical MPI-based program parallelism is expressed by somehow mapping tasks
and data to ranks. For example say we have three arbitrary functions <code class="docutils literal notranslate"><span class="pre">foo</span></code>,
<code class="docutils literal notranslate"><span class="pre">bar</span></code>, and <code class="docutils literal notranslate"><span class="pre">baz`</span> <span class="pre">and</span> <span class="pre">a</span> <span class="pre">chunk</span> <span class="pre">of</span> <span class="pre">data</span> <span class="pre">we</span> <span class="pre">want</span> <span class="pre">to</span> <span class="pre">run</span> <span class="pre">``foo</span></code>, <code class="docutils literal notranslate"><span class="pre">bar</span></code>, and
<code class="docutils literal notranslate"><span class="pre">baz</span></code> on. <a class="reference internal" href="#fig-mpi-mappings"><span class="std std-numref">Fig. 2</span></a> shows the three ways we can do this in
parallel.</p>
<div class="figure align-center" id="id2">
<span id="fig-mpi-mappings"></span><img alt="_images/mpi_mappings.png" src="_images/mpi_mappings.png" />
<p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">Possible ways of mapping data and tasks to MPI ranks.</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</div>
<p>In the <a class="reference internal" href="abbreviations.html#simd"><span class="std std-ref">SIMD</span></a> approach depicted at the top of <a class="reference internal" href="#fig-mpi-mappings"><span class="std std-numref">Fig. 2</span></a> we
distribute the data over the MPI ranks and have each rank pass its local chunk
of data to the three functions. In <a class="reference internal" href="abbreviations.html#misd"><span class="std std-ref">MISD</span></a>, which is shown in the middle of
<a class="reference internal" href="#fig-mpi-mappings"><span class="std std-numref">Fig. 2</span></a> we instead distribute the functions over the ranks.
Finally, in the <a class="reference internal" href="abbreviations.html#mimd"><span class="std std-ref">MIMD</span></a> model shown at the bottom of
<a class="reference internal" href="#fig-mpi-mappings"><span class="std std-numref">Fig. 2</span></a> we distribute both the data and the functions.</p>
<p>Unfortunately on today’s machines it takes more than distributing tasks and/or
data to otherwise opaque ranks to achieve high-performance. This is because
the performance also depends on the hardware available to each rank and how
well utilized that hardware is.</p>
</div>
<div class="section" id="focusing-on-resources">
<h2>Focusing on Resources<a class="headerlink" href="#focusing-on-resources" title="Permalink to this heading"></a></h2>
<p>In ParallelZone we go beyond MPI by mapping tasks/data to hardware, bypassing
the rank concept to the extent possible. More specifically, in ParallelZone we
start by assuming that when a multi-process program starts running there is
some total set of resources (here a “resource” is a somewhat catchall
term that includes CPU, GPU, memory, etc.) available to that program. This
total set of resources may or may not be all of the resources on the computer
and it also may or may not be the case that ParallelZone can access all of the
program’s resources. Regardless, the set of resources ParallelZone can access
forms the <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code>.</p>
<div class="figure align-center" id="id3">
<span id="fig-nesting-runtime-views"></span><img alt="_images/nesting_runtime_views.png" src="_images/nesting_runtime_views.png" />
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">Here the blue oval depicts the total resources the program is allowed to use
and the green oval shows the resources the program lets ParallelZone use. In
the top scenario ParallelZone manages all of the program’s resources, whereas
in the bottom scenario it manages only some of the program’s resources.</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</div>
<p>To better illustrate the relationship between the program’s total resources
and the <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code>, <a class="reference internal" href="#fig-nesting-runtime-views"><span class="std std-numref">Fig. 3</span></a> shows two possible
ways a <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> may initialized. The top scenario shown in
<a class="reference internal" href="#fig-nesting-runtime-views"><span class="std std-numref">Fig. 3</span></a> occurs when the entire program uses
ParallelZone as its parallel runtime. In this scenario a job is spun up with
some set of resources and ParallelZone is allowed to manage all of them
(<em>N.B.</em>, while both scenarios in <a class="reference internal" href="#fig-nesting-runtime-views"><span class="std std-numref">Fig. 3</span></a>
show ParallelZone only managing one node ParallelZone can manage multiple
nodes). Another common scenario occurs when a program relying on ParallelZone is
being driven by another program. In this scenario, the program has access to
more resources than it shares with ParallelZone.</p>
<p>Programs built on ParallelZone treat <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> as the full set of
resources regardless of whether it is or isn’t.</p>
</div>
<div class="section" id="resource-affinity">
<h2>Resource Affinity<a class="headerlink" href="#resource-affinity" title="Permalink to this heading"></a></h2>
<p>Simply knowing the total amounts of resources available isn’t quite enough. We
also need to know which resources the current process has an affinity for. In
ParallelZone we keep this simple by partitioning each process’s resources into
two sets: those it has an affinity for and those it doesn’t. The set of
resources a process has an affinity for is termed that process’s
<code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code>. The <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code> of a process is populated with the
resources in the <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> which are located physically on the node where
the process is running.</p>
<div class="figure align-center" id="id4">
<span id="fig-resource-set-mapping"></span><img alt="_images/resourceset_mapping.png" src="_images/resourceset_mapping.png" />
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">ParallelZone’s view of the runtime environment for the common scenario of
one process per node.</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</div>
<p><a class="reference internal" href="#fig-resource-set-mapping"><span class="std std-numref">Fig. 4</span></a> illustrates how ParallelZone sees the
hardware in the runtime environment when the program has one process running on
each node. In this scenario <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> is managing the entire runtime
environment, meaning the <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> object can see both nodes. The
<code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> is then split in to two <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code> instances, each instance
seeing the node the current process is running on. In this scenario the
<code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code> objects are disjoint, <em>i.e.</em>, they do not share resources.</p>
<p>ParallelZone does not restrict users to running one process per node. If a
user runs more processes per node, then ParallelZone will give each of those
processes its own <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code>; however, the <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code> objects will no
longer be disjoint since each process on a node can see the same resources.</p>
</div>
<div class="section" id="the-vision">
<h2>The Vision<a class="headerlink" href="#the-vision" title="Permalink to this heading"></a></h2>
<p>At the moment ParallelZone’s feature set is pretty bare bones. The medium term
goal is for the <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code> objects to have task schedulers. Users will
estimate the resources needed for a task and tell a particular <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code>
to run the task. The schedulers will automatically figure out how to best run
the task based on runtime conditions. Longer term we want to take this a step
further and add task schedulers to <code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code>. The task schedulers on
<code class="docutils literal notranslate"><span class="pre">RuntimeView</span></code> would accept task graphs and take care of assigning the tasks
in the graph to the schedulers in the individual <code class="docutils literal notranslate"><span class="pre">ResourceSet</span></code> objects.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="user/index.html" class="btn btn-neutral float-right" title="ParallelZone User Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, NWChemEx Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>